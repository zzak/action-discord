name: Notify

on:
  workflow_call:
    secrets:
      DISCORD_WEBHOOK:
        required: true
    inputs:
      result:
        type: string
        required: true
        description: Conclusion of the caller workflow

permissions:
  contents: read

jobs:
  notify_on_fail:
    name: Notify on fail
    runs-on: ubuntu-latest
    if: ${{ inputs.result == 'failure' }}
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - run: |
          echo ${{ github.action_path }}
          ls ${{ github.action_path }}
          cat ${{ github.action_path }}/.github/actions/notify/action.yml
      #- name: Notify
      #  uses: ${{ github.action_path }}/.github/actions/notify/action.yml
      #  with:
      #    color: "16711680"
      #    title: "Failed"
      #    webhook: ${{ secrets.DISCORD_WEBHOOK }}

  notify_on_fixed:
    name: Notify when fixed
    runs-on: ubuntu-latest
    if: ${{ inputs.result == 'success' }}
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - run: echo "Hello, world!"
      #- name: Previous Conclusion
      #  id: previous
      #  uses: ${{ github.action_path }}/.github/actions/previous/action.yml
      #- name: Notify
      #  uses: ${{ github.action_path }}/.github/actions/notify/action.yml
      #  if: ${{ contains(fromJson(steps.previous.outputs.result), 'failure') }}
      #  with:
      #    color: "65280"
      #    title: "Fixed"
      #    webhook: ${{ secrets.DISCORD_WEBHOOK }}
